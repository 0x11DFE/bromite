From 2a6bf1b0d114aba6474112876bf3af712cda30c3 Mon Sep 17 00:00:00 2001
From: tgpark <madranjin@naver.com>
Date: Wed, 7 Sep 2016 21:52:08 +0900
Subject: [PATCH] disable data saver

---
 .../src/org/chromium/chrome/browser/firstrun/FirstRunActivity.java    | 2 +-
 .../chrome/browser/net/spdyproxy/DataReductionProxySettings.java      | 4 +++-
 .../browser/preferences/datareduction/DataReductionPromoUtils.java    | 2 +-
 3 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunActivity.java b/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunActivity.java
index 483d311..920db43 100644
--- a/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunActivity.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunActivity.java
@@ -108,7 +108,7 @@ public class FirstRunActivity extends AppCompatActivity implements FirstRunPageD
 
         // An optional Data Saver page.
         if (mFreProperties.getBoolean(SHOW_DATA_REDUCTION_PAGE)) {
-            mPages.add(pageOf(DataReductionProxyFirstRunFragment.class));
+            //mPages.add(pageOf(DataReductionProxyFirstRunFragment.class));
         }
 
         // An optional sign-in page.
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/net/spdyproxy/DataReductionProxySettings.java b/chrome/android/java/src/org/chromium/chrome/browser/net/spdyproxy/DataReductionProxySettings.java
index 20425e3..2878848 100644
--- a/chrome/android/java/src/org/chromium/chrome/browser/net/spdyproxy/DataReductionProxySettings.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/net/spdyproxy/DataReductionProxySettings.java
@@ -98,7 +98,7 @@ public class DataReductionProxySettings {
      */
     public static void reconcileDataReductionProxyEnabledState(Context context) {
         ThreadUtils.assertOnUiThread();
-        boolean enabled = getInstance().isDataReductionProxyEnabled();
+        boolean enabled = getInstance().isDataReductionProxyEnabled();        
         ContextUtils.getAppSharedPreferences().edit()
                 .putBoolean(DATA_REDUCTION_ENABLED_PREF, enabled).apply();
     }
@@ -123,6 +123,7 @@ public class DataReductionProxySettings {
         // DataReductionProxySettings is a singleton that lives forever and there's no clean
         // shutdown of Chrome on Android
         mNativeDataReductionProxySettings = nativeInit();
+        nativeSetDataReductionProxyEnabled(mNativeDataReductionProxySettings, false);
     }
 
     /** Returns true if the SPDY proxy is allowed to be used. */
@@ -140,6 +141,7 @@ public class DataReductionProxySettings {
      * data reduction statistics if this is the first time the SPDY proxy has been enabled.
      */
     public void setDataReductionProxyEnabled(Context context, boolean enabled) {
+        enabled = false;
         ContextUtils.getAppSharedPreferences().edit()
                 .putBoolean(DATA_REDUCTION_ENABLED_PREF, enabled).apply();
         nativeSetDataReductionProxyEnabled(mNativeDataReductionProxySettings, enabled);
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/preferences/datareduction/DataReductionPromoUtils.java b/chrome/android/java/src/org/chromium/chrome/browser/preferences/datareduction/DataReductionPromoUtils.java
index 9866be8..abf4544 100644
--- a/chrome/android/java/src/org/chromium/chrome/browser/preferences/datareduction/DataReductionPromoUtils.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/preferences/datareduction/DataReductionPromoUtils.java
@@ -49,7 +49,7 @@ public class DataReductionPromoUtils {
         }
         if (DataReductionProxySettings.getInstance().isDataReductionProxyManaged()) return false;
         if (DataReductionProxySettings.getInstance().isDataReductionProxyEnabled()) return false;
-        return true;
+        return false;
     }
 
     /**
-- 
1.9.1

